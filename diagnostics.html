<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ Firebase | –ê–∫–∞–¥–µ–º–∏—è –ê–Ω–Ω—ã –õ–æ–±–∞—á–µ–≤–æ–π</title>
    
    <!-- üå∏ Fonts for Beauty Industry -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;500;600;700&family=Inter:wght@300;400;500;600&family=Playfair+Display:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body style="background: var(--bg-primary); min-height: 100vh; padding: 2rem;">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <div class="card">
                    <div class="card-body">
                        <div class="text-center mb-5">
                            <i class="fas fa-stethoscope fa-3x mb-3" style="color: var(--color-accent);"></i>
                            <h1>–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ Firebase</h1>
                            <p class="text-muted">–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏</p>
                        </div>

                        <!-- –°—Ç–∞—Ç—É—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è -->
                        <div class="mb-4">
                            <h5 class="mb-3"><i class="fas fa-plug me-2"></i>–°—Ç–∞—Ç—É—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è</h5>
                            <div id="connectionStatus" class="alert alert-secondary">
                                <i class="fas fa-spinner fa-spin me-2"></i>–ü—Ä–æ–≤–µ—Ä–∫–∞...
                            </div>
                        </div>

                        <!-- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è -->
                        <div class="mb-4">
                            <h5 class="mb-3"><i class="fas fa-cog me-2"></i>–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è</h5>
                            <div class="table-responsive">
                                <table class="table">
                                    <tbody>
                                        <tr>
                                            <td><strong>API Key:</strong></td>
                                            <td id="configApiKey">-</td>
                                        </tr>
                                        <tr>
                                            <td><strong>Auth Domain:</strong></td>
                                            <td id="configAuthDomain">-</td>
                                        </tr>
                                        <tr>
                                            <td><strong>Database URL:</strong></td>
                                            <td id="configDatabaseURL">-</td>
                                        </tr>
                                        <tr>
                                            <td><strong>Project ID:</strong></td>
                                            <td id="configProjectId">-</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤ -->
                        <div class="mb-4">
                            <h5 class="mb-3"><i class="fas fa-server me-2"></i>–°–µ—Ä–≤–∏—Å—ã Firebase</h5>
                            <div id="servicesStatus" class="row">
                                <div class="col-md-6 mb-3">
                                    <div class="card">
                                        <div class="card-body text-center">
                                            <i class="fas fa-database fa-2x mb-2" style="color: var(--color-accent);"></i>
                                            <h6>Realtime Database</h6>
                                            <span id="dbStatus" class="badge bg-secondary">–ü—Ä–æ–≤–µ—Ä–∫–∞...</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <div class="card">
                                        <div class="card-body text-center">
                                            <i class="fas fa-user-shield fa-2x mb-2" style="color: var(--color-accent);"></i>
                                            <h6>Authentication</h6>
                                            <span id="authStatus" class="badge bg-secondary">–ü—Ä–æ–≤–µ—Ä–∫–∞...</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö -->
                        <div class="mb-4">
                            <h5 class="mb-3"><i class="fas fa-database me-2"></i>–î–∞–Ω–Ω—ã–µ –≤ –±–∞–∑–µ</h5>
                            <div id="dataStatus" class="row">
                                <div class="col-md-4 mb-3">
                                    <div class="card">
                                        <div class="card-body text-center">
                                            <i class="fas fa-book fa-2x mb-2" style="color: var(--color-accent);"></i>
                                            <h6>–ú–æ–¥—É–ª–∏</h6>
                                            <span id="modulesCount" class="badge bg-secondary">-</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <div class="card">
                                        <div class="card-body text-center">
                                            <i class="fas fa-file-alt fa-2x mb-2" style="color: var(--color-accent);"></i>
                                            <h6>–£—Ä–æ–∫–∏</h6>
                                            <span id="lessonsCount" class="badge bg-secondary">-</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <div class="card">
                                        <div class="card-body text-center">
                                            <i class="fas fa-clipboard-question fa-2x mb-2" style="color: var(--color-accent);"></i>
                                            <h6>–¢–µ—Å—Ç—ã</h6>
                                            <span id="testsCount" class="badge bg-secondary">-</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä -->
                        <div class="mb-4">
                            <h5 class="mb-3"><i class="fas fa-user-tie me-2"></i>–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</h5>
                            <div class="card">
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <p><strong>Email:</strong> <code>admin@lobacheva-academy.ru</code></p>
                                            <p><strong>–ü–∞—Ä–æ–ª—å:</strong> <code>Admin2024!</code></p>
                                        </div>
                                        <div class="col-md-6">
                                            <p><strong>–°—Ç–∞—Ç—É—Å:</strong> <span id="adminStatus" class="badge bg-secondary">–ü—Ä–æ–≤–µ—Ä–∫–∞...</span></p>
                                            <button id="createAdminBtn" class="btn btn-primary btn-sm mt-2" onclick="createAdminFromDiagnostics()">
                                                <i class="fas fa-plus me-1"></i>–°–æ–∑–¥–∞—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö -->
                        <div class="mb-4">
                            <h5 class="mb-3"><i class="fas fa-download me-2"></i>–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö</h5>
                            <div class="card">
                                <div class="card-body">
                                    <p class="text-muted mb-3">–°–æ–∑–¥–∞—Å—Ç 10 –º–æ–¥—É–ª–µ–π, 25+ —É—Ä–æ–∫–æ–≤ –∏ —Ç–µ—Å—Ç—ã</p>
                                    <button id="initDataBtn" class="btn btn-primary" onclick="initializeDataFromDiagnostics()">
                                        <i class="fas fa-play me-2"></i>–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ
                                    </button>
                                    <div id="initProgress" class="mt-3 d-none">
                                        <div class="progress">
                                            <div id="initProgressBar" class="progress-bar" style="width: 0%"></div>
                                        </div>
                                        <small id="initStatus" class="text-muted">–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞...</small>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- –õ–æ–≥ -->
                        <div class="mb-4">
                            <h5 class="mb-3"><i class="fas fa-terminal me-2"></i>–õ–æ–≥</h5>
                            <div class="card">
                                <div class="card-body">
                                    <div id="logContainer" style="max-height: 350px; overflow-y: auto; font-family: monospace; font-size: 0.875rem; background: var(--bg-tertiary); padding: 1rem; border-radius: var(--border-radius-md); border: 1px solid var(--glass-border);">
                                        <div class="text-muted">–û–∂–∏–¥–∞–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏...</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π -->
                        <div class="text-center">
                            <a href="index.html" class="btn btn-secondary">
                                <i class="fas fa-home me-2"></i>–ù–∞ –≥–ª–∞–≤–Ω—É—é
                            </a>
                            <a href="login.html" class="btn btn-primary">
                                <i class="fas fa-sign-in-alt me-2"></i>–í–æ–π—Ç–∏
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="firebase-config.js"></script>
    <script src="data-init.js"></script>
    <script>
        // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
        function log(message, type = 'info') {
            const logContainer = document.getElementById('logContainer');
            const timestamp = new Date().toLocaleTimeString();
            const colors = {
                'info': 'text-info',
                'success': 'text-success',
                'warning': 'text-warning',
                'error': 'text-danger'
            };
            const icon = {
                'info': '‚ÑπÔ∏è',
                'success': '‚úÖ',
                'warning': '‚ö†Ô∏è',
                'error': '‚ùå'
            };
            
            const logEntry = document.createElement('div');
            logEntry.className = colors[type] || '';
            logEntry.innerHTML = `<span class="text-muted">[${timestamp}]</span> ${icon[type]} ${message}`;
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
        function checkConfig() {
            log('–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Firebase...', 'info');
            
            try {
                if (typeof firebaseConfig === 'undefined') {
                    log('firebaseConfig –Ω–µ –Ω–∞–π–¥–µ–Ω!', 'error');
                    return false;
                }
                
                document.getElementById('configApiKey').textContent = firebaseConfig.apiKey || '–ù–µ –∑–∞–¥–∞–Ω';
                document.getElementById('configAuthDomain').textContent = firebaseConfig.authDomain || '–ù–µ –∑–∞–¥–∞–Ω';
                document.getElementById('configDatabaseURL').textContent = firebaseConfig.databaseURL || '–ù–µ –∑–∞–¥–∞–Ω';
                document.getElementById('configProjectId').textContent = firebaseConfig.projectId || '–ù–µ –∑–∞–¥–∞–Ω';
                
                if (!firebaseConfig.apiKey || firebaseConfig.apiKey === 'AIzaSyYOUR_API_KEY') {
                    log('API Key –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω!', 'warning');
                    return false;
                }
                
                log('–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω–∞', 'success');
                return true;
            } catch (error) {
                log('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏: ' + error.message, 'error');
                return false;
            }
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Firebase
        async function checkConnection() {
            log('–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Firebase...', 'info');
            
            try {
                if (!firebase.apps.length) {
                    log('Firebase –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω', 'error');
                    document.getElementById('connectionStatus').className = 'alert alert-danger';
                    document.getElementById('connectionStatus').innerHTML = '<i class="fas fa-times-circle me-2"></i>Firebase –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω';
                    return false;
                }
                
                log('Firebase –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω', 'success');
                document.getElementById('connectionStatus').className = 'alert alert-success';
                document.getElementById('connectionStatus').innerHTML = '<i class="fas fa-check-circle me-2"></i>–ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ Firebase';
                return true;
            } catch (error) {
                log('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: ' + error.message, 'error');
                document.getElementById('connectionStatus').className = 'alert alert-danger';
                document.getElementById('connectionStatus').innerHTML = '<i class="fas fa-times-circle me-2"></i>–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: ' + error.message;
                return false;
            }
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤
        async function checkServices() {
            log('–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤ Firebase...', 'info');
            
            try {
                await db.ref('.info/connected').once('value');
                log('Realtime Database: –¥–æ—Å—Ç—É–ø–µ–Ω', 'success');
                document.getElementById('dbStatus').className = 'badge bg-success';
                document.getElementById('dbStatus').textContent = '–î–æ—Å—Ç—É–ø–µ–Ω';
            } catch (error) {
                log('Realtime Database: –æ—à–∏–±–∫–∞ - ' + error.message, 'error');
                document.getElementById('dbStatus').className = 'badge bg-danger';
                document.getElementById('dbStatus').textContent = '–û—à–∏–±–∫–∞';
            }
            
            try {
                auth.onAuthStateChanged(() => {});
                log('Authentication: –¥–æ—Å—Ç—É–ø–µ–Ω', 'success');
                document.getElementById('authStatus').className = 'badge bg-success';
                document.getElementById('authStatus').textContent = '–î–æ—Å—Ç—É–ø–µ–Ω';
            } catch (error) {
                log('Authentication: –æ—à–∏–±–∫–∞ - ' + error.message, 'error');
                document.getElementById('authStatus').className = 'badge bg-danger';
                document.getElementById('authStatus').textContent = '–û—à–∏–±–∫–∞';
            }
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö
        async function checkData() {
            log('–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ –±–∞–∑–µ...', 'info');
            
            try {
                const modulesSnapshot = await db.ref('modules').once('value');
                const modulesCount = modulesSnapshot.exists() ? Object.keys(modulesSnapshot.val()).length : 0;
                document.getElementById('modulesCount').textContent = modulesCount;
                document.getElementById('modulesCount').className = modulesCount > 0 ? 'badge bg-success' : 'badge bg-warning';
                log(`–ú–æ–¥—É–ª–µ–π: ${modulesCount}`, modulesCount > 0 ? 'success' : 'warning');
                
                const lessonsSnapshot = await db.ref('lessons').once('value');
                const lessonsCount = lessonsSnapshot.exists() ? Object.keys(lessonsSnapshot.val()).length : 0;
                document.getElementById('lessonsCount').textContent = lessonsCount;
                document.getElementById('lessonsCount').className = lessonsCount > 0 ? 'badge bg-success' : 'badge bg-warning';
                log(`–£—Ä–æ–∫–æ–≤: ${lessonsCount}`, lessonsCount > 0 ? 'success' : 'warning');
                
                const testsSnapshot = await db.ref('tests').once('value');
                const testsCount = testsSnapshot.exists() ? Object.keys(testsSnapshot.val()).length : 0;
                document.getElementById('testsCount').textContent = testsCount;
                document.getElementById('testsCount').className = testsCount > 0 ? 'badge bg-success' : 'badge bg-warning';
                log(`–¢–µ—Å—Ç–æ–≤: ${testsCount}`, testsCount > 0 ? 'success' : 'warning');
            } catch (error) {
                log('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–∞–Ω–Ω—ã—Ö: ' + error.message, 'error');
            }
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
        async function checkAdmin() {
            log('–ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞...', 'info');
            
            try {
                const usersSnapshot = await db.ref('users').orderByChild('email').equalTo('admin@lobacheva-academy.ru').once('value');
                
                if (usersSnapshot.exists()) {
                    log('–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —Å—É—â–µ—Å—Ç–≤—É–µ—Ç', 'success');
                    document.getElementById('adminStatus').className = 'badge bg-success';
                    document.getElementById('adminStatus').textContent = '–°—É—â–µ—Å—Ç–≤—É–µ—Ç';
                    document.getElementById('createAdminBtn').disabled = true;
                    document.getElementById('createAdminBtn').textContent = '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —Å–æ–∑–¥–∞–Ω';
                } else {
                    log('–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω', 'warning');
                    document.getElementById('adminStatus').className = 'badge bg-warning';
                    document.getElementById('adminStatus').textContent = '–ù–µ —Å–æ–∑–¥–∞–Ω';
                }
            } catch (error) {
                log('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞: ' + error.message, 'error');
                document.getElementById('adminStatus').className = 'badge bg-danger';
                document.getElementById('adminStatus').textContent = '–û—à–∏–±–∫–∞';
            }
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ (–∏–∑ diagnostics.html)
        async function createAdminFromDiagnostics() {
            const btn = document.getElementById('createAdminBtn');
            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i>–°–æ–∑–¥–∞–Ω–∏–µ...';
            
            log('–°–æ–∑–¥–∞–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞...', 'info');
            
            try {
                try {
                    const userCredential = await auth.createUserWithEmailAndPassword('admin@lobacheva-academy.ru', 'Admin2024!');
                    const userId = userCredential.user.uid;

                    await db.ref('users/' + userId).set({
                        name: '–ê–Ω–Ω–∞',
                        surname: '–õ–æ–±–∞—á–µ–≤–∞',
                        email: 'admin@lobacheva-academy.ru',
                        role: 'admin',
                        createdAt: new Date().toISOString()
                    });

                    log('–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —Å–æ–∑–¥–∞–Ω —É—Å–ø–µ—à–Ω–æ!', 'success');
                } catch (createError) {
                    if (createError.code === 'auth/email-already-in-use') {
                        log('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ Auth. –í—Ö–æ–¥–∏–º –≤ —Å–∏—Å—Ç–µ–º—É...', 'info');

                        const userCredential = await auth.signInWithEmailAndPassword('admin@lobacheva-academy.ru', 'Admin2024!');
                        const userId = userCredential.user.uid;

                        const existingUser = await db.ref('users/' + userId).once('value');

                        if (!existingUser.exists()) {
                            await db.ref('users/' + userId).set({
                                name: '–ê–Ω–Ω–∞',
                                surname: '–õ–æ–±–∞—á–µ–≤–∞',
                                email: 'admin@lobacheva-academy.ru',
                                role: 'admin',
                                createdAt: new Date().toISOString()
                            });

                            log('–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –¥–æ–±–∞–≤–ª–µ–Ω –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö!', 'success');
                        } else {
                            log('–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö', 'warning');
                        }

                        await auth.signOut();
                    } else {
                        throw createError;
                    }
                }

                document.getElementById('adminStatus').className = 'badge bg-success';
                document.getElementById('adminStatus').textContent = '–°–æ–∑–¥–∞–Ω';
                btn.innerHTML = '<i class="fas fa-check me-1"></i>–°–æ–∑–¥–∞–Ω–æ';
            } catch (error) {
                log('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞: ' + error.message, 'error');
                btn.disabled = false;
                btn.innerHTML = '<i class="fas fa-plus me-1"></i>–°–æ–∑–¥–∞—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞';
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö (–∏–∑ diagnostics.html)
        async function initializeDataFromDiagnostics() {
            const btn = document.getElementById('initDataBtn');
            const progress = document.getElementById('initProgress');
            const progressBar = document.getElementById('initProgressBar');
            const status = document.getElementById('initStatus');
            
            btn.disabled = true;
            progress.classList.remove('d-none');
            
            log('–ù–∞—á–∏–Ω–∞–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö...', 'info');
            
            try {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Ñ—É–Ω–∫—Ü–∏–π
                log('–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Ñ—É–Ω–∫—Ü–∏–π...', 'info');
                
                // –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ data-init.js
                let attempts = 0;
                const maxAttempts = 10;
                
                while (typeof window.dataInit_initializeApp !== 'function' && attempts < maxAttempts) {
                    log('–û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ data-init.js... (' + (attempts + 1) + '/' + maxAttempts + ')', 'info');
                    await new Promise(resolve => setTimeout(resolve, 300));
                    attempts++;
                }
                
                if (typeof window.dataInit_initializeApp === 'function') {
                    status.textContent = '–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è...';
                    progressBar.style.width = '20%';
                    
                    const result = await window.dataInit_initializeApp();
                    
                    if (result.dataInitialized && result.adminCreated) {
                        progressBar.style.width = '100%';
                        status.textContent = '–ì–æ—Ç–æ–≤–æ!';
                        log('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!', 'success');
                        
                        setTimeout(() => {
                            checkData();
                            checkAdmin();
                        }, 1000);
                    } else {
                        progressBar.style.width = '50%';
                        status.textContent = '–ß–∞—Å—Ç–∏—á–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–æ';
                        log('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —á–∞—Å—Ç–∏—á–Ω–æ', 'warning');
                    }
                } else {
                    log('‚ùå –°–∫—Ä–∏–ø—Ç data-init.js –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω!', 'error');
                    log('–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12)', 'warning');
                    status.textContent = '–û—à–∏–±–∫–∞';
                    progressBar.style.width = '0%';
                }
            } catch (error) {
                log('‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏: ' + error.message, 'error');
                if (error.stack) {
                    log('–°—Ç–µ–∫ –æ—à–∏–±–∫–∏: ' + error.stack, 'error');
                }
                status.textContent = '–û—à–∏–±–∫–∞: ' + error.message;
                progressBar.style.width = '0%';
            }
            
            btn.disabled = false;
        }

        // –ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
        async function runDiagnostics() {
            log('=== –ù–∞—á–∞–ª–æ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ ===', 'info');
            
            const configOk = checkConfig();
            if (!configOk) {
                log('–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ Firebase.', 'error');
                return;
            }
            
            const connected = await checkConnection();
            if (!connected) {
                log('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ Firebase.', 'error');
                return;
            }
            
            await checkServices();
            await checkData();
            await checkAdmin();
            
            log('=== –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ ===', 'info');
            log('–ï—Å–ª–∏ –≤—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ—à–ª–∏ —É—Å–ø–µ—à–Ω–æ, –≤—ã –º–æ–∂–µ—Ç–µ –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É', 'success');
        }

        // –ó–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('load', () => {
            log('–°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞. –ó–∞–ø—É—Å–∫ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏...', 'info');
            setTimeout(runDiagnostics, 500);
        });
    </script>
</body>
</html>
